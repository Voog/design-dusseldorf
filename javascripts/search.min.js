!function(a){var b={lang:"en",resultTpl:'<div class="voog-search-result"><h3 class="voog-search-result-title"><a class="voog-search-result-link" href="[[url]]">[[title]]</a></h3><p class="voog-search-result-content">[[content]]</p></div>',modalTpl:'<div class="voog-search-container"><div class="voog-search-inner"><div class="voog-search-results"></div><div class="voog-search-noresults"></div><div class="voog-search-loader"></div></div></div>',noResults:"No results found!",minChars:3,$parent:a("body"),closeOnSideClick:!0},c=function(c,d){this.$el=c,this.options=a.extend({},b,d),this.init()};c.prototype={init:function(){this.$input=this.$el.find('input[type="search"], input[type="text"]'),this.$modal=this.createModal(),this.$content=this.$modal.find(".voog-search-inner"),this.$loader=this.$modal.find(".voog-search-loader"),this.$results=this.$modal.find(".voog-search-results"),this.$noresults=this.$modal.find(".voog-search-noresults"),this.$clearbtn=this.$el.find(".js-search-close"),this.searcher=new VoogSearchSDK(this.filterParams(this.options),a.proxy(this.handleSearchResult,this)),this.$el.on("submit",a.proxy(this.handleSubmit,this)),this.$input.on("keyup",a.proxy(this.handleInputKeyup,this)),this.$input.on("focus",a.proxy(this.handleInputFocus,this)),this.$input.on("blur",a.proxy(this.handleInputBlur,this)),this.$clearbtn.on("click",a.proxy(this.handleClearButtonClick,this)),this.$content.on("scroll",a.proxy(this.handleModalScroll,this))},createModal:function(){var b=a(this.options.modalTpl);return b.appendTo(this.options.$parent),b},filterParams:function(a){for(var b=["per_page","page","lang","q","types","tags","path","tag_facets"],c={},d=b.length;d--;)"undefined"!=typeof a[b[d]]&&(c[b[d]]=a[b[d]]);return c},handleSubmit:function(a){a.preventDefault();var b=this.$input.data("oldValue")||"",c=this.$input.val();return c!=b&&c.length>=this.options.minChars&&(this.$input.data("oldValue",c),this.doSearch()),!1},handleInputKeyup:function(a){if(this.options.searchOnType){var b=this.$input.data("oldValue")||"",c=this.$input.val();c!=b&&c.length>=this.options.minChars&&(this.$input.data("oldValue",c),this.doSearch())}},handleInputFocus:function(){this.$el.find(".search-box").addClass("search-box-focus")},handleInputBlur:function(){var b=this.options.visibleClass?this.options.visibleClass:"voog-search-visible";a("body").hasClass(b)||this.$el.find(".search-box").removeClass("search-box-focus")},handleSideClick:function(b){a.contains(this.$modal.get(0),b.target)||b.target===this.$modal.get(0)||b.target===this.$input.get(0)||this.reset()},handleClearButtonClick:function(a){a.preventDefault(),this.reset()},handleModalScroll:function(a){var b=this.$content.scrollTop();maxy=this.$content.get(0).scrollHeight-this.$content.get(0).offsetHeight,treshold=10,b>=maxy-10&&!this.loading_active&&this.pageLinks&&this.pageLinks.page<this.pageLinks.total&&this.fetchNextPage()},doSearch:function(){clearTimeout(this.timeout),this.timeout=setTimeout(a.proxy(function(){var b=this.$input.val();if(b.length>=this.options.minChars){var c=!0,d=this.options.visibleClass?this.options.visibleClass:"voog-search-visible";a("body").hasClass(d)||(a("body").addClass(d),this.options.closeOnSideClick&&a(document).on("click.voog-search-sideclick",a.proxy(this.handleSideClick,this)),c=!0),this.setLoader(c),this.loading_active=!0,this.searcher.query({q:b})}},this),400)},setLoader:function(a){this.$results.empty().hide(),this.$noresults.removeClass("voog-search-noresults-visible"),a&&this.$loader.show()},unsetLoader:function(){this.$loader.hide()},hideSearch:function(){var b=this.options.visibleClass?this.options.visibleClass:"voog-search-visible";a("body").removeClass(b),this.$el.find(".search-box").removeClass("search-box-focus"),a(document).off("click.voog-search-sideclick")},reset:function(){this.$input.data("oldValue","").val(""),this.hideSearch()},handleSearchResult:function(a){this.loading_active=!1,this.pageLinks=a.pages,this.renderContent(a.result),this.unsetLoader(),this.testScroll()},renderContent:function(b){if(b.length){this.$results.show();for(var c=0,d=b.length;d>c;c++){var e=this.options.resultTpl.replace(/\[\[url\]\]/g,b[c].path).replace(/\[\[title\]\]/g,b[c].title).replace(/\[\[content\]\]/g,b[c].description);this.$results.append(a(e))}}else this.$noresults.addClass("voog-search-noresults-visible").empty().append("<div>"+this.options.noResults+"</div>").show()},fetchNextPage:function(){this.loading_active=!0,this.pageLinks.next()},testScroll:function(){this.$content.get(0).offsetHeight===this.$content.get(0).scrollHeight&&!this.loading_active&&this.pageLinks&&this.pageLinks.page<this.pageLinks.total&&this.fetchNextPage()}},window.VoogSearch=c}(jQuery);